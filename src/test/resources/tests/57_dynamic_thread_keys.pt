// Test: Dynamic thread keys â€” $var and $(expr) syntax
function worker(name) do
    return name + " done"
end

// Test 1: $var key
key1 = "alpha"
multi r1 do
    thread $(::key1): worker("A")
end
PRINT("var key:", r1.alpha.value)

// Test 2: $(expr) key
prefix = "beta"
multi r2 do
    thread $(::prefix + "_key"): worker("B")
end
PRINT("expr key:", r2.beta_key.value)

// Test 3: Dynamic keys in loop
names = ["x", "y", "z"]
multi r3 do
    loop name in ::names do
        thread $name: worker(name)
    end
end
PRINT("x:", r3.x.value)
PRINT("y:", r3.y.value)
PRINT("z:", r3.z.value)
PRINT("len:", LEN(r3))

// Test 4: Mixed static + dynamic
dynKey = "dyn"
multi r4 do
    thread stat: worker("S")
    thread $(::dynKey): worker("D")
end
PRINT("static:", r4.stat.value)
PRINT("dynamic:", r4.dyn.value)
